
# Women's Health Assistant API

A specialized chatbot API for women's health information with conversation history management.

## Overview

This API provides access to a women's health information assistant powered by LangChain and Google's Generative AI. The system can answer questions about various women's health topics including reproductive health, pregnancy, menopause, hormonal disorders, and more.

Key features:
- Support for both Vietnamese and English questions
- Conversation history management
- Document-grounded responses with citation sources
- Session-based interactions

## Installation

### Prerequisites

- Python 3.8+
- pip package manager
- Google API key for Gemini model access

### Step 1: Clone the Repository


### Step 2: Create .env File

Create a `.env` file in the root directory with your Google API key:

```shell
GOOGLE_API_KEY="your-google-api-key"
```

### Step 3: Install Dependencies

```shell
pip install -r requirements.txt
```

## Adding Documents

The API uses document embeddings to provide accurate information. You need to add PDF documents to the `docs` folder:

1. Create a `docs` folder in the root directory if it doesn't exist
2. Place relevant PDF documents about women's health in this folder
3. The system will automatically load and index these documents on startup

## Running the API

Start the API server with:

```shell
python app/app.py
```

By default, the server will run on `http://localhost:8300`. You can modify the port in the `app.py` file if needed.

## API Endpoints

### 1. Ask a Question

**Endpoint:** `POST /query`

Create a new conversation or continue an existing one by asking a question.

**Request Body:**
```json
{
  "question": "Your question here",
  "session_id": "optional-session-id"
}
```

If no `session_id` is provided, a new session will be created.

**Response:**
```json
{
  "answer": "The response to your question",
  "session_id": "unique-session-id",
  "sources": {
    "document_name.pdf": [1, 2]
  }
}
```

The `sources` field lists the document names and page numbers used to answer the question.

### 2. Get Conversation History

**Endpoint:** `GET /history/{session_id}`

Retrieve the full conversation history for a specific session.

**Response:**
```json
{
  "session_id": "your-session-id",
  "history": [
    {
      "role": "human",
      "content": "Question asked"
    },
    {
      "role": "ai",
      "content": "Answer provided"
    }
  ]
}
```

### 3. Clear Conversation History

**Endpoint:** `DELETE /history/{session_id}`

Clear the conversation history for a specific session while keeping the session alive.

**Response:**
```json
{
  "message": "Chat history for session your-session-id has been cleared"
}
```

## Example Usage

### Start a New Conversation

```shell
curl -X POST "http://localhost:8300/query" \
  -H "Content-Type: application/json" \
  -d '{"question": "Các triệu chứng rối loạn nội tiết?"}'
```

This will return a response with a new `session_id`.

### Continue the Conversation

```shell
curl -X POST "http://localhost:8300/query" \
  -H "Content-Type: application/json" \
  -d '{"question": "Khi nào tôi cần gặp bác sĩ phụ khoa?", "session_id": "0001"}'
```

### View Conversation History

```shell
curl -X GET "http://localhost:8300/history/0001"
```

### Clear Conversation History

```shell
curl -X DELETE "http://localhost:8300/history/0001"
```

## Session Management

- Sessions automatically expire after 30 minutes of inactivity
- Each session has its own conversation history
- Session IDs are UUID strings generated by the server
- To start a new conversation with a clean history, you can either let your current session expire, explicitly clear the history, or simply don't provide a session ID

## Troubleshooting

### Common Issues

1. **API returns 500 error**: Check that your Google API key is valid and has access to the Gemini model
2. **No documents found error**: Ensure you've added PDF files to the `docs` folder
3. **No answer provided**: The question might be too specific or outside the scope of the documents provided

### Logs

Check the API server logs for detailed error information.

# build 
docker build -t medical-chatbot-api:0.0.2 .             